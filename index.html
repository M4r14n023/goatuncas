
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOAT - Gesti√≥n Torneo de Tenis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .tabs { display: flex; background: #f5f5f5; border-bottom: 2px solid #ddd; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; background: #e0e0e0; border: none; font-size: 16px; font-weight: 600; transition: all 0.3s; }
        .tab:hover { background: #d0d0d0; }
        .tab.active { background: white; border-bottom: 3px solid #667eea; }
        .content { padding: 30px; min-height: 500px; }
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        input[type="text"], input[type="number"], textarea, select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; transition: border-color 0.3s; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-right: 10px; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        .team-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 20px; }
        .team-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea; }
        .team-card.goat { border-left-color: #10b981; background: #ecfdf5; }
        .match-grid { display: grid; gap: 15px; margin-top: 20px; }
        .match-card { background: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px solid #ddd; }
        .match-card.bonus { border-color: #f59e0b; background: #fffbeb; }
        .match-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .match-type { font-weight: 700; color: #1e3c72; font-size: 16px; }
        .match-time { background: #667eea; color: white; padding: 5px 12px; border-radius: 6px; font-size: 14px; }
        .stats-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .stats-table th, .stats-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        .stats-table th { background: #f5f5f5; font-weight: 700; color: #1e3c72; }
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-header { font-size: 24px; font-weight: 700; margin-bottom: 20px; color: #1e3c72; }
        .warning { background: #fef3c7; border: 2px solid #f59e0b; padding: 15px; border-radius: 8px; margin: 15px 0; color: #92400e; font-weight: 600; }
        .checkbox-container { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        .captain-badge { background: #f59e0b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px; }
        .sube-badge { background: #8b5cf6; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px; }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const JERARQUIA_CATEGORIAS = {
            'caballeros_2da': 'caballeros_3ra',
            'caballeros_3ra': 'caballeros_4ta',
            'caballeros_4ta': 'caballeros_5ta',
            'damas_a': 'damas_b',
            'damas_b': 'damas_c'
        };

        const PARTIDOS = [
            // DAMAS
            { id: 9, tipo: "Dobles Damas A/B", categorias: ["damas_a", "damas_b"], numJugadores: 2, grupo: "damas" },
            { id: 21, tipo: "Dobles Damas A", categorias: ["damas_a"], numJugadores: 2, grupo: "damas" },
            { id: 16, tipo: "Dobles Damas B", categorias: ["damas_b"], numJugadores: 2, grupo: "damas" },
            { id: 26, tipo: "Dobles Damas B/C", categorias: ["damas_b", "damas_c"], numJugadores: 2, grupo: "damas" },
            { id: 1, tipo: "Dobles Damas C-1", categorias: ["damas_c"], numJugadores: 2, grupo: "damas" },
            { id: 22, tipo: "Dobles Damas C-2", categorias: ["damas_c"], numJugadores: 2, grupo: "damas" },
            
            // MIXTOS
            { id: 4, tipo: "Mixto D (Dama A + Caballero 2da)", categorias: ["damas_a", "caballeros_2da"], numJugadores: 2, mixto: true, grupo: "mixtos" },
            { id: 14, tipo: "Mixto A (Dama A + Caballero 3ra)", categorias: ["damas_a", "caballeros_3ra"], numJugadores: 2, mixto: true, grupo: "mixtos" },
            { id: 19, tipo: "Mixto B (Dama B + Caballero 4ta)", categorias: ["damas_b", "caballeros_4ta"], numJugadores: 2, mixto: true, grupo: "mixtos" },
            { id: 11, tipo: "Mixto E (Dama B + Caballero 5ta)", categorias: ["damas_b", "caballeros_5ta"], numJugadores: 2, mixto: true, grupo: "mixtos" },
            { id: 8, tipo: "Mixto C (Dama C + Caballero 5ta)", categorias: ["damas_c", "caballeros_5ta"], numJugadores: 2, mixto: true, grupo: "mixtos" },
            
            // SINGLES CABALLEROS
            { id: 20, tipo: "Single Caballero 2da", categorias: ["caballeros_2da"], numJugadores: 1, grupo: "singles" },
            { id: 10, tipo: "Single Caballero 3ra", categorias: ["caballeros_3ra"], numJugadores: 1, grupo: "singles" },
            { id: 6, tipo: "Single Caballero 4ta", categorias: ["caballeros_4ta"], numJugadores: 1, grupo: "singles" },
            { id: 24, tipo: "Single Caballero 5ta", categorias: ["caballeros_5ta"], numJugadores: 1, grupo: "singles" },
            
            // DOBLES CABALLEROS PUROS
            { id: 7, tipo: "Dobles Caballeros 2da/2da", categorias: ["caballeros_2da"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 15, tipo: "Dobles Caballeros 2da", categorias: ["caballeros_2da"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 5, tipo: "Dobles Caballeros 3ra/3ra", categorias: ["caballeros_3ra"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 18, tipo: "Dobles Caballeros 3ra", categorias: ["caballeros_3ra"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 12, tipo: "Dobles Caballeros 4ta/4ta", categorias: ["caballeros_4ta"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 23, tipo: "Dobles Caballeros 4ta", categorias: ["caballeros_4ta"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 3, tipo: "Dobles Caballeros 5ta/5ta", categorias: ["caballeros_5ta"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 13, tipo: "Dobles Caballeros 5ta", categorias: ["caballeros_5ta"], numJugadores: 2, grupo: "dobles_puros" },
            
            // DOBLES CABALLEROS COMBINADOS
            { id: 25, tipo: "Caballeros 2da/3ra", categorias: ["caballeros_2da", "caballeros_3ra"], numJugadores: 2, grupo: "dobles_combinados" },
            { id: 2, tipo: "Dobles Caballeros 3ra/4ta", categorias: ["caballeros_3ra", "caballeros_4ta"], numJugadores: 2, grupo: "dobles_combinados" },
            { id: 17, tipo: "Dobles Caballeros 4ta/5ta", categorias: ["caballeros_4ta", "caballeros_5ta"], numJugadores: 2, grupo: "dobles_combinados" }
        ];

        const JUGADORES_GOAT = {
            caballeros_2da: [
                { nombre: "Maxi", categoria: "caballeros_2da" },
                { nombre: "Hernan", categoria: "caballeros_2da" },
                { nombre: "Walter", categoria: "caballeros_2da", capitan: true },
                { nombre: "Charly", categoria: "caballeros_2da" }
            ],
            caballeros_3ra: [
                { nombre: "Mariano", categoria: "caballeros_3ra" },
                { nombre: "Tomy", categoria: "caballeros_3ra" },
                { nombre: "Nico", categoria: "caballeros_3ra" },
                { nombre: "Chicho", categoria: "caballeros_3ra" }
            ],
            caballeros_4ta: [
                { nombre: "Rodri", categoria: "caballeros_4ta" },
                { nombre: "Marce", categoria: "caballeros_4ta" },
                { nombre: "Facu", categoria: "caballeros_4ta" },
                { nombre: "Santi", categoria: "caballeros_4ta" }
            ],
            caballeros_5ta: [
                { nombre: "Toto", categoria: "caballeros_5ta" },
                { nombre: "Tibu", categoria: "caballeros_5ta" },
                { nombre: "Bocha", categoria: "caballeros_5ta" },
                { nombre: "Peka", categoria: "caballeros_5ta" },
                { nombre: "Nacho", categoria: "caballeros_5ta" }
            ],
            damas_a: [
                { nombre: "Caro Demar√≠a", categoria: "damas_a" },
                { nombre: "Kari", categoria: "damas_a" },
                { nombre: "Grace", categoria: "damas_a" }
            ],
            damas_b: [
                { nombre: "Mariela", categoria: "damas_b" },
                { nombre: "Mariana", categoria: "damas_b" },
                { nombre: "Caro Razquin", categoria: "damas_b" },
                { nombre: "Beltra", categoria: "damas_b" }
            ],
            damas_c: [
                { nombre: "Nelly", categoria: "damas_c" },
                { nombre: "Marina", categoria: "damas_c" },
                { nombre: "Lulu", categoria: "damas_c" },
                { nombre: "Caro Sorbi", categoria: "damas_c" }
            ]
        };

        function getCategoriaOriginal(nombreJugador) {
            for (const [cat, jugadores] of Object.entries(JUGADORES_GOAT)) {
                if (jugadores.find(j => j.nombre === nombreJugador)) {
                    return cat;
                }
            }
            return null;
        }

        function App() {
            const [activeTab, setActiveTab] = useState('configuracion');
            const [numEquipos, setNumEquipos] = useState(10);
            const [equipos, setEquipos] = useState([]);
            const [fechas, setFechas] = useState([]);
            const [resultados, setResultados] = useState({});
            
            const [configSubirCategoria, setConfigSubirCategoria] = useState({
                habilitado: false,
                reglas: {}
            });

            useEffect(() => {
                const datosGuardados = localStorage.getItem('goat_torneo_data_v2');
                if (datosGuardados) {
                    try {
                        const datos = JSON.parse(datosGuardados);
                        setNumEquipos(datos.numEquipos || 10);
                        setEquipos(datos.equipos || []);
                        setFechas(datos.fechas || []);
                        setResultados(datos.resultados || {});
                        setConfigSubirCategoria(datos.configSubirCategoria || { habilitado: false, reglas: {} });
                    } catch (e) {
                        console.error('Error al cargar datos:', e);
                    }
                }
            }, []);

            useEffect(() => {
                const datos = { numEquipos, equipos, fechas, resultados, configSubirCategoria };
                localStorage.setItem('goat_torneo_data_v2', JSON.stringify(datos));
            }, [numEquipos, equipos, fechas, resultados, configSubirCategoria]);

            useEffect(() => {
                if (equipos.length === 0) {
                    setEquipos([{ nombre: 'GOAT', esGoat: true }]);
                }
            }, []);

            const guardarEquiposRivales = (nombres) => {
                const rivales = nombres.filter(n => n.trim() !== '').map(nombre => ({
                    nombre: nombre.trim(),
                    esGoat: false
                }));
                setEquipos([{ nombre: 'GOAT', esGoat: true }, ...rivales]);
            };

            const agregarFecha = (numFecha, rival) => {
                const nuevaFecha = {
                    numero: numFecha,
                    rival: rival,
                    partidos: PARTIDOS.map(p => ({
                        ...p,
                        jugadores: [],
                        horario: '',
                        dia: 'sabado',
                        ganado: false
                    })),
                    partidoBonus: null
                };
                
                const nuevasFechas = [...fechas];
                nuevasFechas[numFecha - 1] = nuevaFecha;
                setFechas(nuevasFechas);
            };

            const actualizarJugadores = (fechaIndex, partidoId, jugadores) => {
                const nuevasFechas = [...fechas];
                const partidoIndex = nuevasFechas[fechaIndex].partidos.findIndex(p => p.id === partidoId);
                if (partidoIndex !== -1) {
                    nuevasFechas[fechaIndex].partidos[partidoIndex].jugadores = jugadores;
                }
                setFechas(nuevasFechas);
            };

            const contarPartidosJugador = (fechaIndex, nombreJugador) => {
                const fecha = fechas[fechaIndex];
                let count = 0;
                const catOriginal = getCategoriaOriginal(nombreJugador);

                fecha.partidos.forEach(partido => {
                    if (partido.jugadores.includes(nombreJugador)) {
                        if (configSubirCategoria.habilitado) {
                            const esPartidoDeCategoriaSuperior = partido.categorias.some(catPartido => {
                                const catInferior = JERARQUIA_CATEGORIAS[catPartido];
                                return catInferior === catOriginal;
                            });

                            if (esPartidoDeCategoriaSuperior) return;
                        }
                        count++;
                    }
                });
                return count;
            };

            const generarPDF = (fechaIndex) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const fecha = fechas[fechaIndex];
                
                doc.setFontSize(20);
                doc.text(`GOAT - Fecha ${fecha.numero}`, 105, 20, { align: 'center' });
                doc.setFontSize(14);
                doc.text(`vs ${fecha.rival}`, 105, 30, { align: 'center' });
                
                let y = 45;
                
                const partidosPorHorario = {};
                fecha.partidos.filter(p => p.horario).forEach(partido => {
                    const key = `${partido.dia}-${partido.horario}`;
                    if (!partidosPorHorario[key]) partidosPorHorario[key] = { dia: partido.dia, hora: partido.horario, partidos: [] };
                    partidosPorHorario[key].partidos.push(partido);
                });
                
                const horariosPorDia = { sabado: [], domingo: [] };
                Object.values(partidosPorHorario).forEach(h => horariosPorDia[h.dia].push(h));
                
                const sortHoras = (a, b) => a.hora.localeCompare(b.hora);
                horariosPorDia.sabado.sort(sortHoras);
                horariosPorDia.domingo.sort(sortHoras);
                
                ['sabado', 'domingo'].forEach(dia => {
                    if (horariosPorDia[dia].length > 0) {
                        if (y > 250) { doc.addPage(); y = 20; }
                        doc.setFontSize(14); doc.setFont(undefined, 'bold');
                        doc.text(dia.toUpperCase(), 20, y);
                        y += 8;
                        doc.setFont(undefined, 'normal'); doc.setFontSize(10);
                        
                        horariosPorDia[dia].forEach(horario => {
                            horario.partidos.sort((a, b) => (a.posicion || 0) - (b.posicion || 0));
                            horario.partidos.forEach(partido => {
                                const esBonus = fecha.partidoBonus === partido.id;
                                const jugadoresTexto = partido.jugadores.length > 0 ? partido.jugadores.join(' / ') : 'Sin asignar';
                                const texto = `${horario.hora} - P${partido.posicion} - ${partido.tipo}${esBonus ? ' ‚òÖBONUS‚òÖ' : ''}: ${jugadoresTexto}`;
                                if (y > 275) { doc.addPage(); y = 20; }
                                if (esBonus) doc.setFont(undefined, 'bold');
                                doc.text(texto, 20, y);
                                if (esBonus) doc.setFont(undefined, 'normal');
                                y += 6;
                            });
                            y += 2;
                        });
                        y += 5;
                    }
                });
                
                const partidosPorJugador = {};
                fecha.partidos.forEach(partido => {
                    if (partido.horario) {
                        partido.jugadores.forEach(j => partidosPorJugador[j] = (partidosPorJugador[j] || 0) + 1);
                    }
                });

                if (Object.keys(partidosPorJugador).length > 0) {
                    if (y + (Object.keys(partidosPorJugador).length * 5) + 20 > 280) { doc.addPage(); y = 20; } 
                    else { y += 10; }
                    
                    doc.setFontSize(12); doc.setFont(undefined, 'bold');
                    doc.text('RESUMEN DE CONVOCATORIA', 20, y);
                    y += 8; doc.setFont(undefined, 'normal'); doc.setFontSize(9);
                    
                    Object.entries(partidosPorJugador).sort((a, b) => b[1] - a[1]).forEach(([jugador, cantidad]) => {
                        const partidosReales = contarPartidosJugador(fechaIndex, jugador);
                        const jugadorObj = Object.values(JUGADORES_GOAT).flat().find(j => j.nombre === jugador);
                        const esCapitan = jugadorObj?.capitan ? ' (CAP)' : '';
                        const extraNote = (cantidad > partidosReales) ? ` (${cantidad - partidosReales} fuera de cat.)` : '';
                        
                        doc.text(`${jugador}${esCapitan}: ${cantidad} total${extraNote} -> Computan: ${partidosReales}`, 25, y);
                        y += 5;
                    });
                }
                
                doc.save(`GOAT-Fecha${fecha.numero}-vs-${fecha.rival}.pdf`);
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>üéæ GOAT - Gesti√≥n Torneo de Tenis</h1>
                    </div>
                    <div className="tabs">
                        <button className={`tab ${activeTab === 'configuracion' ? 'active' : ''}`} onClick={() => setActiveTab('configuracion')}>Configuraci√≥n</button>
                        <button className={`tab ${activeTab === 'fechas' ? 'active' : ''}`} onClick={() => setActiveTab('fechas')}>Fechas</button>
                        <button className={`tab ${activeTab === 'resultados' ? 'active' : ''}`} onClick={() => setActiveTab('resultados')}>Resultados</button>
                    </div>
                    <div className="content">
                        {activeTab === 'configuracion' && (
                            <ConfiguracionTab numEquipos={numEquipos} setNumEquipos={setNumEquipos} equipos={equipos} guardarEquiposRivales={guardarEquiposRivales} agregarFecha={agregarFecha} fechas={fechas} />
                        )}
                        {activeTab === 'fechas' && (
                            <FechasTab fechas={fechas} actualizarJugadores={actualizarJugadores} contarPartidosJugador={contarPartidosJugador} generarPDF={generarPDF} setFechas={setFechas} configSubirCategoria={configSubirCategoria} setConfigSubirCategoria={setConfigSubirCategoria} />
                        )}
                        {activeTab === 'resultados' && (
                            <ResultadosTab fechas={fechas} resultados={resultados} setResultados={setResultados} />
                        )}
                    </div>
                </div>
            );
        }

        function ConfiguracionTab({ numEquipos, setNumEquipos, equipos, guardarEquiposRivales, agregarFecha, fechas }) {
            const [showModalEquipos, setShowModalEquipos] = useState(false);
            const [tempNombres, setTempNombres] = useState(Array(9).fill(''));

            const handleNumEquiposChange = (val) => {
                setNumEquipos(val);
                if (val === 10 && equipos.length <= 1) {
                    setShowModalEquipos(true);
                    setTempNombres(Array(9).fill(''));
                }
            };

            const handleGuardarModal = () => {
                guardarEquiposRivales(tempNombres);
                setShowModalEquipos(false);
            };

            const handleNombreChange = (index, valor) => {
                const nuevos = [...tempNombres];
                nuevos[index] = valor;
                setTempNombres(nuevos);
            };

            return (
                <div>
                    <h2>Configuraci√≥n del Torneo</h2>
                    <div className="form-group">
                        <label>N√∫mero total de equipos</label>
                        <div style={{display:'flex', gap:'10px'}}>
                            <input type="number" value={numEquipos} onChange={(e) => handleNumEquiposChange(parseInt(e.target.value))} min="2" max="20" />
                            {numEquipos === 10 && (
                                <button className="btn btn-primary" onClick={() => setShowModalEquipos(true)}>
                                    Editar Rivales
                                </button>
                            )}
                        </div>
                    </div>

                    {equipos.length > 1 && (
                        <div className="team-list">
                            {equipos.map((eq, idx) => (
                                <div key={idx} className={`team-card ${eq.esGoat ? 'goat' : ''}`}>
                                    <strong>{eq.nombre}</strong>{eq.esGoat && <span> ‚≠ê</span>}
                                </div>
                            ))}
                        </div>
                    )}

                    {equipos.length >= numEquipos && (
                        <div style={{marginTop: '40px'}}>
                            <h3>Configurar Rivales por Fecha</h3>
                            {[1, 2, 3, 4].map(numFecha => (
                                <div key={numFecha} className="form-group">
                                    <label>Rival Fecha {numFecha}</label>
                                    <select value={fechas[numFecha-1]?.rival || ''} onChange={(e) => e.target.value && agregarFecha(numFecha, e.target.value)}>
                                        <option value="">Seleccionar rival...</option>
                                        {equipos.filter(eq => !eq.esGoat).map((eq, idx) => (
                                            <option key={idx} value={eq.nombre}>{eq.nombre}</option>
                                        ))}
                                    </select>
                                </div>
                            ))}
                        </div>
                    )}

                    {showModalEquipos && (
                        <div className="modal">
                            <div className="modal-content">
                                <h3 className="modal-header">Ingresar Nombres de los 9 Rivales</h3>
                                <div className="grid-inputs">
                                    {tempNombres.map((nombre, i) => (
                                        <div key={i}>
                                            <label>Equipo {i + 1}</label>
                                            <input type="text" value={nombre} onChange={(e) => handleNombreChange(i, e.target.value)} placeholder={`Nombre Rival ${i+1}`} />
                                        </div>
                                    ))}
                                </div>
                                <div style={{marginTop: '20px', display:'flex', justifyContent:'flex-end'}}>
                                    <button className="btn btn-primary" onClick={handleGuardarModal}>Guardar Equipos</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function FechasTab({ fechas, actualizarJugadores, contarPartidosJugador, generarPDF, setFechas, configSubirCategoria, setConfigSubirCategoria }) {
            const [fechaSeleccionada, setFechaSeleccionada] = useState(0);
            const [showHorarioModal, setShowHorarioModal] = useState(false);
            const [horarioActual, setHorarioActual] = useState({ dia: 'sabado', hora: '09:00', partido1: '', partido2: '' });
            const [showModalSubir, setShowModalSubir] = useState(false);

            if (fechas.length === 0) return <div className="warning">Configure equipos y fechas primero.</div>;

            const fecha = fechas[fechaSeleccionada];
            const partidosSinAsignar = PARTIDOS.filter(p => !fecha.partidos.find(fp => fp.id === p.id).horario);

            const toggleReglaSubida = (categoriaSuperior) => {
                setConfigSubirCategoria(prev => ({
                    ...prev,
                    reglas: {
                        ...prev.reglas,
                        [categoriaSuperior]: !prev.reglas[categoriaSuperior]
                    }
                }));
            };

            const agregarHorario = () => {
                const nuevasFechas = [...fechas];
                [horarioActual.partido1, horarioActual.partido2].forEach((pid, idx) => {
                    if(!pid) return;
                    const pIdx = nuevasFechas[fechaSeleccionada].partidos.findIndex(p => p.id === parseInt(pid));
                    if(pIdx !== -1) {
                        nuevasFechas[fechaSeleccionada].partidos[pIdx].horario = horarioActual.hora;
                        nuevasFechas[fechaSeleccionada].partidos[pIdx].dia = horarioActual.dia;
                        nuevasFechas[fechaSeleccionada].partidos[pIdx].posicion = idx + 1;
                    }
                });
                setFechas(nuevasFechas);
                setShowHorarioModal(false);
                setHorarioActual({ dia: 'sabado', hora: '09:00', partido1: '', partido2: '' });
            };

            const OPCIONES_HORARIOS = [
                // S√ÅBADO
                { dia: 'sabado', hora: '09:00' },
                { dia: 'sabado', hora: '10:30' },
                { dia: 'sabado', hora: '12:00' },
                { dia: 'sabado', hora: '13:30' },
                { dia: 'sabado', hora: '15:00' },
                { dia: 'sabado', hora: '16:30' },
                { dia: 'sabado', hora: '17:45' }, // √öltimo turno S√°bado

                // DOMINGO
                { dia: 'domingo', hora: '09:00' },
                { dia: 'domingo', hora: '10:30' },
                { dia: 'domingo', hora: '12:00' },
                { dia: 'domingo', hora: '13:30' },
                { dia: 'domingo', hora: '15:00' },
                { dia: 'domingo', hora: '16:30' }  // √öltimo turno Domingo
            ];

            return (
                <div>
                    <div style={{display:'flex', justifyContent:'space-between', alignItems:'center'}}>
                        <h2>Armado de Fechas</h2>
                        <div className="checkbox-container" style={{background:'#eee', padding:'8px 15px', borderRadius:'8px'}}>
                            <input 
                                type="checkbox" 
                                checked={configSubirCategoria.habilitado} 
                                onChange={(e) => {
                                    const checked = e.target.checked;
                                    setConfigSubirCategoria(prev => ({ ...prev, habilitado: checked }));
                                    if(checked) setShowModalSubir(true);
                                }}
                            />
                            <label onClick={() => setShowModalSubir(true)} style={{cursor:'pointer'}}>
                                Habilitar jugadores de categor√≠a inferior {configSubirCategoria.habilitado && '‚öôÔ∏è'}
                            </label>
                        </div>
                    </div>
                    
                    <div className="form-group">
                        <label>Seleccionar Fecha</label>
                        <select value={fechaSeleccionada} onChange={(e) => setFechaSeleccionada(parseInt(e.target.value))}>
                            {fechas.map((f, idx) => <option key={idx} value={idx}>Fecha {f.numero} - vs {f.rival}</option>)}
                        </select>
                    </div>

                    <div className="date-section">
                        <div style={{display:'flex', gap:'10px'}}>
                            <button className="btn btn-primary" onClick={() => setShowHorarioModal(true)}>‚ûï Agregar Horario</button>
                            <button className="btn btn-success" onClick={() => generarPDF(fechaSeleccionada)}>üìÑ PDF</button>
                        </div>
                        
                        <div className="match-grid">
                            {fecha.partidos.filter(p => p.horario).sort((a,b) => {
                                if(a.dia !== b.dia) return a.dia === 'sabado' ? -1 : 1;
                                return a.hora.localeCompare(b.hora);
                            }).map(partido => (
                                <PartidoCard 
                                    key={partido.id} 
                                    partido={partido} 
                                    fechaIndex={fechaSeleccionada} 
                                    actualizarJugadores={actualizarJugadores} 
                                    contarPartidosJugador={contarPartidosJugador}
                                    configSubirCategoria={configSubirCategoria}
                                />
                            ))}
                        </div>
                    </div>

                    {showHorarioModal && (
                        <div className="modal">
                            <div className="modal-content">
                                <div className="modal-header">Agregar Horario</div>
                                <div className="form-group">
                                    <label>Horario</label>
                                    <select value={horarioActual.hora} onChange={(e) => {
                                        const op = OPCIONES_HORARIOS.find(o => o.hora === e.target.value);
                                        setHorarioActual({...horarioActual, hora: e.target.value, dia: op.dia});
                                    }}>
                                        {OPCIONES_HORARIOS.map((op, i) => (
                                            <option key={i} value={op.hora}>{op.dia === 'sabado' ? 'S√°b' : 'Dom'} {op.hora}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>Partido 1</label>
                                    <select value={horarioActual.partido1} onChange={(e) => setHorarioActual({...horarioActual, partido1: e.target.value})}>
                                        <option value="">Seleccionar...</option>
                                        {partidosSinAsignar.map(p => <option key={p.id} value={p.id}>{p.tipo}</option>)}
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>Partido 2</label>
                                    <select value={horarioActual.partido2} onChange={(e) => setHorarioActual({...horarioActual, partido2: e.target.value})}>
                                        <option value="">Seleccionar...</option>
                                        {partidosSinAsignar.filter(p => p.id != horarioActual.partido1).map(p => <option key={p.id} value={p.id}>{p.tipo}</option>)}
                                    </select>
                                </div>
                                <button className="btn btn-primary" onClick={agregarHorario}>Guardar</button>
                                <button className="btn btn-danger" onClick={() => setShowHorarioModal(false)}>Cancelar</button>
                            </div>
                        </div>
                    )}

                    {showModalSubir && (
                        <div className="modal">
                            <div className="modal-content">
                                <div className="modal-header">Configurar Subida de Categor√≠a</div>
                                <p style={{marginBottom:'15px'}}>Marque las categor√≠as superiores que aceptar√°n jugadores de la categor√≠a inmediatamente inferior para esta fecha.</p>
                                <div style={{display:'grid', gap:'10px'}}>
                                    {Object.keys(JERARQUIA_CATEGORIAS).map(catSup => (
                                        <div key={catSup} className="checkbox-container" style={{background:'#f9f9f9', padding:'10px', borderRadius:'6px'}}>
                                            <input 
                                                type="checkbox" 
                                                checked={configSubirCategoria.reglas[catSup] || false}
                                                onChange={() => toggleReglaSubida(catSup)}
                                            />
                                            <label>
                                                En <strong>{catSup.replace('_', ' ').toUpperCase()}</strong> pueden jugar los de <strong>{JERARQUIA_CATEGORIAS[catSup].replace('_', ' ').toUpperCase()}</strong>
                                            </label>
                                        </div>
                                    ))}
                                </div>
                                <div style={{marginTop:'20px', textAlign:'right'}}>
                                    <button className="btn btn-primary" onClick={() => setShowModalSubir(false)}>Cerrar</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function PartidoCard({ partido, fechaIndex, actualizarJugadores, contarPartidosJugador, configSubirCategoria }) {
            let jugadoresDisponibles = partido.categorias.flatMap(cat => 
                JUGADORES_GOAT[cat]?.map(j => ({...j, origen: 'base'})) || []
            );

            if (configSubirCategoria.habilitado) {
                partido.categorias.forEach(catPartido => {
                    if (configSubirCategoria.reglas[catPartido]) {
                        const catInferior = JERARQUIA_CATEGORIAS[catPartido];
                        if (catInferior && JUGADORES_GOAT[catInferior]) {
                            const jugadoresInf = JUGADORES_GOAT[catInferior].map(j => ({
                                ...j,
                                origen: 'sube' 
                            }));
                            jugadoresDisponibles = [...jugadoresDisponibles, ...jugadoresInf];
                        }
                    }
                });
            }

            const agregarJugador = (nombre) => {
                if (partido.jugadores.length >= partido.numJugadores) return alert('Partido lleno');
                const jugadorObj = jugadoresDisponibles.find(j => j.nombre === nombre);
                const esSubida = jugadorObj?.origen === 'sube';

                const partidosJugados = contarPartidosJugador(fechaIndex, nombre);
                
                if (!esSubida && partidosJugados >= 3) {
                    return alert(`${nombre} ya tiene 3 partidos computables.`);
                }
                
                actualizarJugadores(fechaIndex, partido.id, [...partido.jugadores, nombre]);
            };

            return (
                <div className="match-card">
                    <div className="match-header">
                        <div className="match-type">{partido.tipo}</div>
                        <div className="match-time">{partido.dia === 'sabado'?'S√°b':'Dom'} {partido.horario}</div>
                    </div>
                    <div style={{marginBottom:'10px'}}>
                        {partido.jugadores.map((j, idx) => (
                            <span key={idx} style={{background:'#667eea', color:'white', padding:'4px 8px', borderRadius:'4px', marginRight:'5px', display:'inline-block'}}>
                                {j} <span style={{cursor:'pointer', marginLeft:'5px'}} onClick={() => actualizarJugadores(fechaIndex, partido.id, partido.jugadores.filter((_,i)=>i!==idx))}>x</span>
                            </span>
                        ))}
                    </div>
                    {partido.jugadores.length < partido.numJugadores && (
                        <select onChange={(e) => { e.target.value && agregarJugador(e.target.value); e.target.value=''; }}>
                            <option value="">Agregar...</option>
                            {jugadoresDisponibles
                                .filter(j => !partido.jugadores.includes(j.nombre))
                                .map((j, idx) => {
                                    const count = contarPartidosJugador(fechaIndex, j.nombre);
                                    const labelSubida = j.origen === 'sube' ? ' (SUBE CAT - NO SUMA)' : ` (${count}/3)`;
                                    return <option key={idx} value={j.nombre}>{j.nombre}{labelSubida}</option>
                                })
                            }
                        </select>
                    )}
                </div>
            );
        }

        function ResultadosTab({ fechas, resultados, setResultados }) {
            const toggle = (fid, pid) => setResultados(prev => ({...prev, [`${fid}-${pid}`]: !prev[`${fid}-${pid}`]}));
            return (
                <div>
                    <h2>Resultados</h2>
                    {fechas.map((f, fi) => (
                        <div key={fi} className="date-section">
                            <h3>vs {f.rival}</h3>
                            {f.partidos.filter(p=>p.jugadores.length>0).map(p => (
                                <div key={p.id} style={{padding:'10px', background: resultados[`${fi}-${p.id}`]?'#d1fae5':'#fee2e2', margin:'5px 0', borderRadius:'5px', display:'flex', justifyContent:'space-between'}}>
                                    <span>{p.tipo} ({p.jugadores.join('/')})</span>
                                    <label><input type="checkbox" checked={!!resultados[`${fi}-${p.id}`]} onChange={()=>toggle(fi, p.id)} /> Ganado</label>
                                </div>
                            ))}
                        </div>
                    ))}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

