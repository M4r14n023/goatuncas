<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOAT - Gesti√≥n Torneo de Tenis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #e0e0e0;
            border: none;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #d0d0d0;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
            min-height: 500px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 150px;
            font-family: monospace;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .team-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .team-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .team-card.goat {
            border-left-color: #10b981;
            background: #ecfdf5;
        }

        .match-grid {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .match-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .match-card.bonus {
            border-color: #f59e0b;
            background: #fffbeb;
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .match-type {
            font-weight: 700;
            color: #1e3c72;
            font-size: 16px;
        }

        .match-time {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .player-select {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .stats-section {
            margin-bottom: 30px;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .stats-table th,
        .stats-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .stats-table th {
            background: #f5f5f5;
            font-weight: 700;
            color: #1e3c72;
        }

        .stats-table tr:hover {
            background: #f9fafb;
        }

        .warning {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            color: #92400e;
            font-weight: 600;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #1e3c72;
        }

        .phase-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .date-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .date-header {
            font-size: 20px;
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 15px;
        }

        .player-count-warning {
            color: #dc2626;
            font-size: 12px;
            margin-top: 5px;
        }

        .success-message {
            background: #d1fae5;
            border: 2px solid #10b981;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            color: #065f46;
            font-weight: 600;
        }

        .captain-badge {
            background: #f59e0b;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const PARTIDOS = [
            // DAMAS
            { id: 9, tipo: "Dobles Damas A/B", categorias: ["damas_a", "damas_b"], numJugadores: 2, grupo: "damas" },
            { id: 21, tipo: "Dobles Damas A", categorias: ["damas_a"], numJugadores: 2, grupo: "damas" },
            { id: 16, tipo: "Dobles Damas B", categorias: ["damas_b"], numJugadores: 2, grupo: "damas" },
            { id: 26, tipo: "Dobles Damas B/C", categorias: ["damas_b", "damas_c"], numJugadores: 2, grupo: "damas" },
            { id: 1, tipo: "Dobles Damas C-1", categorias: ["damas_c"], numJugadores: 2, grupo: "damas" },
            { id: 22, tipo: "Dobles Damas C-2", categorias: ["damas_c"], numJugadores: 2, grupo: "damas" },
            
            // MIXTOS
            { id: 4, tipo: "Mixto D (Dama A + Caballero 2da)", categorias: ["damas_a", "caballeros_2da"], numJugadores: 2, mixto: true, grupo: "mixtos" },
            { id: 14, tipo: "Mixto A (Dama A + Caballero 3ra)", categorias: ["damas_a", "caballeros_3ra"], numJugadores: 2, mixto: true, grupo: "mixtos" },
            { id: 19, tipo: "Mixto B (Dama B + Caballero 4ta)", categorias: ["damas_b", "caballeros_4ta"], numJugadores: 2, mixto: true, grupo: "mixtos" },
            { id: 11, tipo: "Mixto E (Dama B + Caballero 5ta)", categorias: ["damas_b", "caballeros_5ta"], numJugadores: 2, mixto: true, grupo: "mixtos" },
            { id: 8, tipo: "Mixto C (Dama C + Caballero 5ta)", categorias: ["damas_c", "caballeros_5ta"], numJugadores: 2, mixto: true, grupo: "mixtos" },
            
            // SINGLES CABALLEROS
            { id: 20, tipo: "Single Caballero 2da", categorias: ["caballeros_2da"], numJugadores: 1, grupo: "singles" },
            { id: 10, tipo: "Single Caballero 3ra", categorias: ["caballeros_3ra"], numJugadores: 1, grupo: "singles" },
            { id: 6, tipo: "Single Caballero 4ta", categorias: ["caballeros_4ta"], numJugadores: 1, grupo: "singles" },
            { id: 24, tipo: "Single Caballero 5ta", categorias: ["caballeros_5ta"], numJugadores: 1, grupo: "singles" },
            
            // DOBLES CABALLEROS PUROS
            { id: 7, tipo: "Dobles Caballeros 2da/2da", categorias: ["caballeros_2da"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 15, tipo: "Dobles Caballeros 2da", categorias: ["caballeros_2da"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 5, tipo: "Dobles Caballeros 3ra/3ra", categorias: ["caballeros_3ra"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 18, tipo: "Dobles Caballeros 3ra", categorias: ["caballeros_3ra"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 12, tipo: "Dobles Caballeros 4ta/4ta", categorias: ["caballeros_4ta"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 23, tipo: "Dobles Caballeros 4ta", categorias: ["caballeros_4ta"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 3, tipo: "Dobles Caballeros 5ta/5ta", categorias: ["caballeros_5ta"], numJugadores: 2, grupo: "dobles_puros" },
            { id: 13, tipo: "Dobles Caballeros 5ta", categorias: ["caballeros_5ta"], numJugadores: 2, grupo: "dobles_puros" },
            
            // DOBLES CABALLEROS COMBINADOS
            { id: 25, tipo: "Caballeros 2da/3ra", categorias: ["caballeros_2da", "caballeros_3ra"], numJugadores: 2, grupo: "dobles_combinados" },
            { id: 2, tipo: "Dobles Caballeros 3ra/4ta", categorias: ["caballeros_3ra", "caballeros_4ta"], numJugadores: 2, grupo: "dobles_combinados" },
            { id: 17, tipo: "Dobles Caballeros 4ta/5ta", categorias: ["caballeros_4ta", "caballeros_5ta"], numJugadores: 2, grupo: "dobles_combinados" }
        ];

        const JUGADORES_GOAT = {
            caballeros_2da: [
                { nombre: "Maxi", categoria: "caballeros_2da" },
                { nombre: "Hernan", categoria: "caballeros_2da" },
                { nombre: "Walter", categoria: "caballeros_2da", capitan: true },
                { nombre: "Charly", categoria: "caballeros_2da" }
            ],
            caballeros_3ra: [
                { nombre: "Mariano", categoria: "caballeros_3ra" },
                { nombre: "Tomy", categoria: "caballeros_3ra" },
                { nombre: "Nico", categoria: "caballeros_3ra" },
                { nombre: "Chicho", categoria: "caballeros_3ra" }
            ],
            caballeros_4ta: [
                { nombre: "Rodri", categoria: "caballeros_4ta" },
                { nombre: "Marce", categoria: "caballeros_4ta" },
                { nombre: "Facu", categoria: "caballeros_4ta" },
                { nombre: "Santi", categoria: "caballeros_4ta" }
            ],
            caballeros_5ta: [
                { nombre: "Toto", categoria: "caballeros_5ta" },
                { nombre: "Tibu", categoria: "caballeros_5ta" },
                { nombre: "Bocha", categoria: "caballeros_5ta" },
                { nombre: "Peka", categoria: "caballeros_5ta" },
                { nombre: "Nacho", categoria: "caballeros_5ta" }
            ],
            damas_a: [
                { nombre: "Caro Demar√≠a", categoria: "damas_a" },
                { nombre: "Kari", categoria: "damas_a" },
                { nombre: "Grace", categoria: "damas_a" }
            ],
            damas_b: [
                { nombre: "Mariela", categoria: "damas_b" },
                { nombre: "Mariana", categoria: "damas_b" },
                { nombre: "Caro Razquin", categoria: "damas_b" },
                { nombre: "Beltra", categoria: "damas_b" }
            ],
            damas_c: [
                { nombre: "Nelly", categoria: "damas_c" },
                { nombre: "Marina", categoria: "damas_c" },
                { nombre: "Lulu", categoria: "damas_c" },
                { nombre: "Caro Sorbi", categoria: "damas_c" }
            ]
        };

        function App() {
            const [activeTab, setActiveTab] = useState('configuracion');
            const [numEquipos, setNumEquipos] = useState(10);
            const [equipos, setEquipos] = useState([]);
            const [fechas, setFechas] = useState([]);
            const [showFinalModal, setShowFinalModal] = useState(false);
            const [posiciones, setPosiciones] = useState({});
            const [resultados, setResultados] = useState({});

            // Cargar datos al iniciar
            useEffect(() => {
                const datosGuardados = localStorage.getItem('goat_torneo_data');
                if (datosGuardados) {
                    try {
                        const datos = JSON.parse(datosGuardados);
                        setNumEquipos(datos.numEquipos || 10);
                        setEquipos(datos.equipos || []);
                        setFechas(datos.fechas || []);
                        setResultados(datos.resultados || {});
                        setPosiciones(datos.posiciones || {});
                    } catch (e) {
                        console.error('Error al cargar datos:', e);
                    }
                }
            }, []);

            // Guardar datos cuando cambian
            useEffect(() => {
                const datos = {
                    numEquipos,
                    equipos,
                    fechas,
                    resultados,
                    posiciones
                };
                localStorage.setItem('goat_torneo_data', JSON.stringify(datos));
            }, [numEquipos, equipos, fechas, resultados, posiciones]);

            useEffect(() => {
                if (numEquipos === 10 && equipos.length === 0) {
                    setEquipos([{ nombre: 'GOAT', esGoat: true }]);
                }
            }, [numEquipos]);

            const agregarEquipos = (texto) => {
                const lineas = texto.split('\n').filter(l => l.trim());
                const nuevosEquipos = lineas.map(linea => ({
                    nombre: linea.trim(),
                    esGoat: false
                }));
                setEquipos([{ nombre: 'GOAT', esGoat: true }, ...nuevosEquipos]);
            };

            const agregarFecha = (numFecha, rival) => {
                const nuevaFecha = {
                    numero: numFecha,
                    rival: rival,
                    partidos: PARTIDOS.map(p => ({
                        ...p,
                        jugadores: [],
                        horario: '',
                        dia: 'sabado',
                        ganado: false
                    })),
                    partidoBonus: null,
                    categoriasHabilitadas: {
                        caballeros_5ta_en_4ta: false,
                        caballeros_4ta_en_3ra: false,
                        caballeros_3ra_en_2da: false,
                        damas_c_en_b: false,
                        damas_b_en_a: false
                    },
                    jugadoresHabilitados: []
                };
                
                const nuevasFechas = [...fechas];
                nuevasFechas[numFecha - 1] = nuevaFecha;
                setFechas(nuevasFechas);
            };

            const procesarHorarios = (fechaIndex, texto) => {
                const lineas = texto.split('\n').filter(l => l.trim());
                const fechaActual = {...fechas[fechaIndex]};
                
                lineas.forEach(linea => {
                    const match = linea.match(/(\d+)\s*[-.:]\s*(.+)/);
                    if (match) {
                        const numPartido = parseInt(match[1]);
                        const info = match[2].trim();
                        
                        const horarioMatch = info.match(/(\d{1,2}):(\d{2})/);
                        const diaMatch = info.toLowerCase().includes('dom') ? 'domingo' : 'sabado';
                        
                        const partidoIndex = fechaActual.partidos.findIndex(p => p.id === numPartido);
                        if (partidoIndex !== -1) {
                            fechaActual.partidos[partidoIndex].horario = horarioMatch ? `${horarioMatch[1]}:${horarioMatch[2]}` : '';
                            fechaActual.partidos[partidoIndex].dia = diaMatch;
                        }
                    }
                });
                
                const nuevasFechas = [...fechas];
                nuevasFechas[fechaIndex] = fechaActual;
                setFechas(nuevasFechas);
            };

            const actualizarJugadores = (fechaIndex, partidoId, jugadores) => {
                const nuevasFechas = [...fechas];
                const partidoIndex = nuevasFechas[fechaIndex].partidos.findIndex(p => p.id === partidoId);
                
                if (partidoIndex !== -1) {
                    nuevasFechas[fechaIndex].partidos[partidoIndex].jugadores = jugadores;
                }
                
                setFechas(nuevasFechas);
            };

            const contarPartidosJugador = (fechaIndex, nombreJugador) => {
                const fecha = fechas[fechaIndex];
                let count = 0;
                fecha.partidos.forEach(partido => {
                    if (partido.jugadores.some(j => j === nombreJugador)) {
                        count++;
                    }
                });
                return count;
            };

            const toggleResultado = (fechaIndex, partidoId) => {
                const key = `${fechaIndex}-${partidoId}`;
                setResultados(prev => ({
                    ...prev,
                    [key]: !prev[key]
                }));
            };

            const generarPDF = (fechaIndex) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const fecha = fechas[fechaIndex];
                
                doc.setFontSize(20);
                doc.text(`GOAT - Fecha ${fecha.numero}`, 105, 20, { align: 'center' });
                doc.setFontSize(14);
                doc.text(`vs ${fecha.rival}`, 105, 30, { align: 'center' });
                
                let y = 45;
                
                // Agrupar por d√≠a y horario
                const partidosPorHorario = {};
                fecha.partidos
                    .filter(p => p.horario)
                    .forEach(partido => {
                        const key = `${partido.dia}-${partido.horario}`;
                        if (!partidosPorHorario[key]) {
                            partidosPorHorario[key] = { dia: partido.dia, hora: partido.horario, partidos: [] };
                        }
                        partidosPorHorario[key].partidos.push(partido);
                    });
                
                const horariosPorDia = {
                    sabado: [],
                    domingo: []
                };
                
                Object.values(partidosPorHorario).forEach(horario => {
                    horariosPorDia[horario.dia].push(horario);
                });
                
                // Ordenar por hora
                horariosPorDia.sabado.sort((a, b) => a.hora.localeCompare(b.hora));
                horariosPorDia.domingo.sort((a, b) => a.hora.localeCompare(b.hora));
                
                // MOSTRAR CONVOCATORIA COMPLETA
                ['sabado', 'domingo'].forEach(dia => {
                    if (horariosPorDia[dia].length > 0) {
                        if (y > 250) {
                            doc.addPage();
                            y = 20;
                        }
                        
                        doc.setFontSize(14);
                        doc.setFont(undefined, 'bold');
                        doc.text(dia.toUpperCase(), 20, y);
                        y += 8;
                        doc.setFont(undefined, 'normal');
                        doc.setFontSize(10);
                        
                        horariosPorDia[dia].forEach(horario => {
                            // Ordenar partidos por posici√≥n
                            horario.partidos.sort((a, b) => (a.posicion || 0) - (b.posicion || 0));
                            
                            horario.partidos.forEach(partido => {
                                const esBonus = fecha.partidoBonus === partido.id;
                                const jugadoresTexto = partido.jugadores.length > 0 
                                    ? partido.jugadores.join(' / ') 
                                    : 'Sin asignar';
                                
                                const texto = `${horario.hora} - P${partido.posicion} - ${partido.tipo}${esBonus ? ' ‚òÖBONUS‚òÖ' : ''}: ${jugadoresTexto}`;
                                
                                if (y > 275) {
                                    doc.addPage();
                                    y = 20;
                                }
                                
                                if (esBonus) {
                                    doc.setFont(undefined, 'bold');
                                }
                                doc.text(texto, 20, y);
                                if (esBonus) {
                                    doc.setFont(undefined, 'normal');
                                }
                                y += 6;
                            });
                            y += 2;
                        });
                        y += 5;
                    }
                });
                
                // MOSTRAR RESUMEN DE JUGADORES AL FINAL
                // Calcular partidos por jugador
                const partidosPorJugador = {};
                fecha.partidos.forEach(partido => {
                    if (partido.horario) {
                        partido.jugadores.forEach(jugador => {
                            partidosPorJugador[jugador] = (partidosPorJugador[jugador] || 0) + 1;
                        });
                    }
                });
                
                if (Object.keys(partidosPorJugador).length > 0) {
                    // Verificar si necesitamos nueva p√°gina
                    if (y + (Object.keys(partidosPorJugador).length * 5) + 20 > 280) {
                        doc.addPage();
                        y = 20;
                    } else {
                        y += 10;
                    }
                    
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('RESUMEN DE CONVOCATORIA', 20, y);
                    y += 8;
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(9);
                    
                    Object.entries(partidosPorJugador)
                        .sort((a, b) => b[1] - a[1])
                        .forEach(([jugador, cantidad]) => {
                            const jugadorObj = Object.values(JUGADORES_GOAT).flat().find(j => j.nombre === jugador);
                            const esCapitan = jugadorObj?.capitan ? ' (CAPITAN)' : '';
                            const advertencia = cantidad > 3 ? ' *** EXCEDE LIMITE ***' : '';
                            
                            if (cantidad > 3) {
                                doc.setFont(undefined, 'bold');
                            }
                            doc.text(`${jugador}${esCapitan}: ${cantidad} partido${cantidad > 1 ? 's' : ''}${advertencia}`, 25, y);
                            if (cantidad > 3) {
                                doc.setFont(undefined, 'normal');
                            }
                            y += 5;
                        });
                }
                
                doc.save(`GOAT-Fecha${fecha.numero}-vs-${fecha.rival}.pdf`);
            };

            const calcularEstadisticas = () => {
                const stats = {
                    jugadores: {},
                    parejas: {}
                };
                
                const todosJugadores = Object.values(JUGADORES_GOAT).flat();
                todosJugadores.forEach(jugador => {
                    stats.jugadores[jugador.nombre] = {
                        singles: { ganados: 0, perdidos: 0 },
                        dobles: { ganados: 0, perdidos: 0 },
                        total: { ganados: 0, perdidos: 0 }
                    };
                });
                
                fechas.forEach((fecha, fechaIdx) => {
                    fecha.partidos.forEach(partido => {
                        if (partido.jugadores.length > 0) {
                            const key = `${fechaIdx}-${partido.id}`;
                            const ganado = resultados[key] || false;
                            const esSingle = partido.numJugadores === 1;
                            
                            partido.jugadores.forEach(jugador => {
                                if (stats.jugadores[jugador]) {
                                    if (esSingle) {
                                        stats.jugadores[jugador].singles[ganado ? 'ganados' : 'perdidos']++;
                                    } else {
                                        stats.jugadores[jugador].dobles[ganado ? 'ganados' : 'perdidos']++;
                                    }
                                    stats.jugadores[jugador].total[ganado ? 'ganados' : 'perdidos']++;
                                }
                            });
                            
                            if (!esSingle && partido.jugadores.length === 2) {
                                const parejaKey = [...partido.jugadores].sort().join(' - ');
                                if (!stats.parejas[parejaKey]) {
                                    stats.parejas[parejaKey] = { ganados: 0, perdidos: 0, fechas: [] };
                                }
                                stats.parejas[parejaKey][ganado ? 'ganados' : 'perdidos']++;
                                stats.parejas[parejaKey].fechas.push({
                                    fecha: fecha.numero,
                                    rival: fecha.rival,
                                    tipo: partido.tipo,
                                    resultado: ganado
                                });
                            }
                        }
                    });
                });
                
                return stats;
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>üéæ GOAT - Gesti√≥n Torneo de Tenis</h1>
                        <p>Sistema completo de seguimiento y armado de fechas</p>
                    </div>

                    <div className="tabs">
                        <button 
                            className={`tab ${activeTab === 'configuracion' ? 'active' : ''}`}
                            onClick={() => setActiveTab('configuracion')}
                        >
                            Configuraci√≥n
                        </button>
                        <button 
                            className={`tab ${activeTab === 'fechas' ? 'active' : ''}`}
                            onClick={() => setActiveTab('fechas')}
                        >
                            Fechas
                        </button>
                        <button 
                            className={`tab ${activeTab === 'resultados' ? 'active' : ''}`}
                            onClick={() => setActiveTab('resultados')}
                        >
                            Resultados
                        </button>
                        <button 
                            className={`tab ${activeTab === 'estadisticas' ? 'active' : ''}`}
                            onClick={() => setActiveTab('estadisticas')}
                        >
                            Estad√≠sticas
                        </button>
                    </div>

                    <div className="content">
                        {activeTab === 'configuracion' && (
                            <ConfiguracionTab 
                                numEquipos={numEquipos}
                                setNumEquipos={setNumEquipos}
                                equipos={equipos}
                                agregarEquipos={agregarEquipos}
                                agregarFecha={agregarFecha}
                                fechas={fechas}
                            />
                        )}

                        {activeTab === 'fechas' && (
                            <FechasTab 
                                fechas={fechas}
                                procesarHorarios={procesarHorarios}
                                actualizarJugadores={actualizarJugadores}
                                contarPartidosJugador={contarPartidosJugador}
                                generarPDF={generarPDF}
                                setFechas={setFechas}
                            />
                        )}

                        {activeTab === 'resultados' && (
                            <ResultadosTab 
                                fechas={fechas}
                                resultados={resultados}
                                toggleResultado={toggleResultado}
                            />
                        )}

                        {activeTab === 'estadisticas' && (
                            <EstadisticasTab 
                                calcularEstadisticas={calcularEstadisticas}
                            />
                        )}
                    </div>
                </div>
            );
        }

        function ConfiguracionTab({ numEquipos, setNumEquipos, equipos, agregarEquipos, agregarFecha, fechas }) {
            const [rivalFecha1, setRivalFecha1] = useState('');
            const [rivalFecha2, setRivalFecha2] = useState('');
            const [rivalFecha3, setRivalFecha3] = useState('');
            const [rivalFecha4, setRivalFecha4] = useState('');
            const [showEquiposModal, setShowEquiposModal] = useState(false);
            const [nombresEquipos, setNombresEquipos] = useState(['', '', '', '', '', '', '', '', '']);

            const handleCargarEquipos = () => {
                if (numEquipos === 10) {
                    setShowEquiposModal(true);
                }
            };

            const guardarEquipos = () => {
                const equiposValidos = nombresEquipos.filter(n => n.trim() !== '');
                if (equiposValidos.length !== 9) {
                    alert('Debes completar los nombres de los 9 equipos');
                    return;
                }
                
                const equiposTexto = equiposValidos.join('\n');
                agregarEquipos(equiposTexto);
                setShowEquiposModal(false);
                setNombresEquipos(['', '', '', '', '', '', '', '', '']);
            };

            return (
                <div>
                    <h2 style={{marginBottom: '20px', color: '#1e3c72'}}>Configuraci√≥n del Torneo</h2>
                    
                    <div className="form-group">
                        <label>N√∫mero total de equipos</label>
                        <input 
                            type="number" 
                            value={numEquipos}
                            onChange={(e) => setNumEquipos(parseInt(e.target.value))}
                            min="2"
                            max="20"
                        />
                    </div>

                    {numEquipos === 10 && equipos.length < 10 && (
                        <div className="form-group">
                            <button 
                                className="btn btn-primary"
                                onClick={handleCargarEquipos}
                            >
                                Cargar Equipos Rivales
                            </button>
                        </div>
                    )}

                    {showEquiposModal && (
                        <div className="modal" onClick={() => {}}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    Ingresar nombres de los 9 equipos rivales
                                </div>

                                {nombresEquipos.map((nombre, idx) => (
                                    <div className="form-group" key={idx}>
                                        <label>Equipo {idx + 1}</label>
                                        <input 
                                            type="text"
                                            value={nombre}
                                            onChange={(e) => {
                                                const nuevos = [...nombresEquipos];
                                                nuevos[idx] = e.target.value;
                                                setNombresEquipos(nuevos);
                                            }}
                                            placeholder={`Nombre del equipo ${idx + 1}`}
                                        />
                                    </div>
                                ))}

                                <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                                    <button className="btn btn-primary" onClick={guardarEquipos}>
                                        Guardar Equipos
                                    </button>
                                    <button className="btn btn-danger" onClick={() => {
                                        setShowEquiposModal(false);
                                        setNombresEquipos(['', '', '', '', '', '', '', '', '']);
                                    }}>
                                        Cancelar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {equipos.length > 0 && (
                        <div>
                            <h3 style={{marginTop: '30px', marginBottom: '15px'}}>Equipos Registrados</h3>
                            <div className="team-list">
                                {equipos.map((eq, idx) => (
                                    <div key={idx} className={`team-card ${eq.esGoat ? 'goat' : ''}`}>
                                        <strong>{eq.nombre}</strong>
                                        {eq.esGoat && <span> ‚≠ê (Nuestro Equipo)</span>}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {equipos.length === 10 && (
                        <div style={{marginTop: '40px'}}>
                            <h3 style={{marginBottom: '20px'}}>Configurar Fechas</h3>
                            
                            {[1, 2, 3, 4].map(numFecha => (
                                <div key={numFecha} className="form-group">
                                    <label>Rival Fecha {numFecha}</label>
                                    <select 
                                        value={fechas[numFecha-1]?.rival || ''}
                                        onChange={(e) => {
                                            if (numFecha === 1) setRivalFecha1(e.target.value);
                                            if (numFecha === 2) setRivalFecha2(e.target.value);
                                            if (numFecha === 3) setRivalFecha3(e.target.value);
                                            if (numFecha === 4) setRivalFecha4(e.target.value);
                                            if (e.target.value) {
                                                agregarFecha(numFecha, e.target.value);
                                            }
                                        }}
                                    >
                                        <option value="">Seleccionar rival...</option>
                                        {equipos.filter(eq => !eq.esGoat).map((eq, idx) => (
                                            <option key={idx} value={eq.nombre}>{eq.nombre}</option>
                                        ))}
                                    </select>
                                </div>
                            ))}

                            {fechas.length === 4 && (
                                <div className="success-message">
                                    ‚úì Todas las fechas configuradas. Ir a la pesta√±a "Fechas" para armar los equipos.
                                </div>
                            )}

                            <div style={{marginTop: '30px', paddingTop: '30px', borderTop: '2px solid #ddd'}}>
                                <button 
                                    className="btn btn-danger"
                                    onClick={() => {
                                        if (confirm('¬øEst√°s seguro de que quer√©s borrar todos los datos? Esta acci√≥n no se puede deshacer.')) {
                                            localStorage.removeItem('goat_torneo_data');
                                            window.location.reload();
                                        }
                                    }}
                                >
                                    üóëÔ∏è Resetear todos los datos
                                </button>
                                <p style={{marginTop: '10px', fontSize: '12px', color: '#666'}}>
                                    Los datos se guardan autom√°ticamente en tu navegador
                                </p>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function FechasTab({ fechas, procesarHorarios, actualizarJugadores, contarPartidosJugador, generarPDF, setFechas }) {
            const [fechaSeleccionada, setFechaSeleccionada] = useState(0);
            const [showHorarioModal, setShowHorarioModal] = useState(false);
            const [horarioActual, setHorarioActual] = useState({ dia: 'sabado', hora: '09:00', partido1: '', partido2: '' });
            const [editandoHorario, setEditandoHorario] = useState(null);
            const [showCategoriasModal, setShowCategoriasModal] = useState(false);
            const [categoriasTemp, setCategoriasTemp] = useState({});
            const [jugadoresHabilitadosTemp, setJugadoresHabilitadosTemp] = useState([]);

            if (fechas.length === 0) {
                return (
                    <div className="warning">
                        Por favor, configure primero los equipos y las fechas en la pesta√±a "Configuraci√≥n".
                    </div>
                );
            }

            const fecha = fechas[fechaSeleccionada];

            const abrirCategoriasModal = () => {
                setCategoriasTemp(fecha.categoriasHabilitadas || {
                    caballeros_5ta_en_4ta: false,
                    caballeros_4ta_en_3ra: false,
                    caballeros_3ra_en_2da: false,
                    damas_c_en_b: false,
                    damas_b_en_a: false
                });
                setJugadoresHabilitadosTemp(fecha.jugadoresHabilitados || []);
                setShowCategoriasModal(true);
            };

            const guardarCategorias = () => {
                const nuevasFechas = [...fechas];
                nuevasFechas[fechaSeleccionada].categoriasHabilitadas = categoriasTemp;
                nuevasFechas[fechaSeleccionada].jugadoresHabilitados = jugadoresHabilitadosTemp;
                setFechas(nuevasFechas);
                setShowCategoriasModal(false);
            };

            const toggleJugadorHabilitado = (nombreJugador, categoriaDestino) => {
                const existe = jugadoresHabilitadosTemp.find(j => j.jugador === nombreJugador && j.categoriaDestino === categoriaDestino);
                if (existe) {
                    setJugadoresHabilitadosTemp(jugadoresHabilitadosTemp.filter(j => !(j.jugador === nombreJugador && j.categoriaDestino === categoriaDestino)));
                } else {
                    setJugadoresHabilitadosTemp([...jugadoresHabilitadosTemp, { jugador: nombreJugador, categoriaDestino }]);
                }
            };

            const getPartidosDisponibles = (excluirPartido = null) => {
                return PARTIDOS.filter(p => {
                    if (editandoHorario) {
                        const partidoDelHorario = fecha.partidos.find(fp => 
                            fp.id === p.id && 
                            fp.horario === editandoHorario.horario && 
                            fp.dia === editandoHorario.dia
                        );
                        if (partidoDelHorario) return true;
                    }
                    
                    if (excluirPartido && p.id === excluirPartido) return false;
                    
                    const partidoAsignado = fecha.partidos.find(fp => fp.id === p.id);
                    return !partidoAsignado.horario;
                });
            };

            const partidosDisponiblesP1 = getPartidosDisponibles();
            const partidosDisponiblesP2 = getPartidosDisponibles(parseInt(horarioActual.partido1));

            const agregarHorario = () => {
                if (!horarioActual.partido1 || !horarioActual.partido2) {
                    alert('Debes seleccionar los 2 partidos para este horario');
                    return;
                }

                const nuevasFechas = [...fechas];
                const fechaIdx = fechaSeleccionada;

                if (editandoHorario) {
                    nuevasFechas[fechaIdx].partidos = nuevasFechas[fechaIdx].partidos.map(p => {
                        if (p.dia === editandoHorario.dia && p.horario === editandoHorario.horario) {
                            return { ...p, dia: 'sabado', horario: '', posicion: undefined };
                        }
                        return p;
                    });
                }

                const idx1 = nuevasFechas[fechaIdx].partidos.findIndex(p => p.id === parseInt(horarioActual.partido1));
                if (idx1 !== -1) {
                    nuevasFechas[fechaIdx].partidos[idx1].horario = horarioActual.hora;
                    nuevasFechas[fechaIdx].partidos[idx1].dia = horarioActual.dia;
                    nuevasFechas[fechaIdx].partidos[idx1].posicion = 1;
                }

                const idx2 = nuevasFechas[fechaIdx].partidos.findIndex(p => p.id === parseInt(horarioActual.partido2));
                if (idx2 !== -1) {
                    nuevasFechas[fechaIdx].partidos[idx2].horario = horarioActual.hora;
                    nuevasFechas[fechaIdx].partidos[idx2].dia = horarioActual.dia;
                    nuevasFechas[fechaIdx].partidos[idx2].posicion = 2;
                }

                setFechas(nuevasFechas);
                setEditandoHorario(null);
                
                const partidosSinAsignar = PARTIDOS.filter(p => {
                    const partidoAsignado = nuevasFechas[fechaIdx].partidos.find(fp => fp.id === p.id);
                    return !partidoAsignado.horario;
                });

                if (partidosSinAsignar.length >= 2) {
                    const horariosUsados = {};
                    nuevasFechas[fechaIdx].partidos.forEach(p => {
                        if (p.horario) {
                            const key = `${p.dia}-${p.horario}`;
                            horariosUsados[key] = true;
                        }
                    });

                    const horariosPosibles = [
                        { dia: 'sabado', hora: '09:00' },
                        { dia: 'sabado', hora: '10:30' },
                        { dia: 'sabado', hora: '12:00' },
                        { dia: 'sabado', hora: '13:30' },
                        { dia: 'sabado', hora: '15:00' },
                        { dia: 'sabado', hora: '16:30' },
                        { dia: 'sabado', hora: '17:45' },
                        { dia: 'domingo', hora: '09:00' },
                        { dia: 'domingo', hora: '10:30' },
                        { dia: 'domingo', hora: '12:00' },
                        { dia: 'domingo', hora: '13:30' },
                        { dia: 'domingo', hora: '15:00' }
                    ];

                    const siguienteHorario = horariosPosibles.find(h => !horariosUsados[`${h.dia}-${h.hora}`]);

                    if (siguienteHorario) {
                        setHorarioActual({
                            dia: siguienteHorario.dia,
                            hora: siguienteHorario.hora,
                            partido1: '',
                            partido2: ''
                        });
                    } else {
                        setShowHorarioModal(false);
                        setHorarioActual({ dia: 'sabado', hora: '09:00', partido1: '', partido2: '' });
                    }
                } else {
                    setShowHorarioModal(false);
                    setHorarioActual({ dia: 'sabado', hora: '09:00', partido1: '', partido2: '' });
                    if (partidosSinAsignar.length === 0) {
                        alert('¬°Todos los partidos han sido asignados!');
                    }
                }
            };

            const eliminarHorario = (dia, hora) => {
                if (confirm(`¬øEliminar los partidos del ${dia} a las ${hora}?`)) {
                    const nuevasFechas = [...fechas];
                    nuevasFechas[fechaSeleccionada].partidos = nuevasFechas[fechaSeleccionada].partidos.map(p => {
                        if (p.dia === dia && p.horario === hora) {
                            return { ...p, dia: 'sabado', horario: '', posicion: undefined };
                        }
                        return p;
                    });
                    setFechas(nuevasFechas);
                }
            };

            const editarHorario = (dia, hora) => {
                const partidos = fecha.partidos.filter(p => p.dia === dia && p.horario === hora);
                if (partidos.length === 2) {
                    const p1 = partidos.find(p => p.posicion === 1);
                    const p2 = partidos.find(p => p.posicion === 2);
                    setHorarioActual({
                        dia: dia,
                        hora: hora,
                        partido1: p1 ? p1.id.toString() : '',
                        partido2: p2 ? p2.id.toString() : ''
                    });
                    setEditandoHorario({ dia, horario: hora });
                    setShowHorarioModal(true);
                }
            };

            const partidosPorHorario = {};
            fecha.partidos.forEach(partido => {
                if (partido.horario) {
                    const key = `${partido.dia}-${partido.horario}`;
                    if (!partidosPorHorario[key]) {
                        partidosPorHorario[key] = { dia: partido.dia, hora: partido.horario, partidos: [] };
                    }
                    partidosPorHorario[key].partidos.push(partido);
                }
            });

            const partidosSinAsignar = PARTIDOS.filter(p => {
                const partidoAsignado = fecha.partidos.find(fp => fp.id === p.id);
                return !partidoAsignado.horario;
            });

            const categoriasHabilitadasCount = fecha.jugadoresHabilitados ? fecha.jugadoresHabilitados.length : 0;

            return (
                <div>
                    <h2 style={{marginBottom: '20px', color: '#1e3c72'}}>Armado de Fechas</h2>
                    
                    <div className="form-group">
                        <label>Seleccionar Fecha</label>
                        <select 
                            value={fechaSeleccionada}
                            onChange={(e) => setFechaSeleccionada(parseInt(e.target.value))}
                        >
                            {fechas.map((f, idx) => (
                                <option key={idx} value={idx}>
                                    Fecha {f.numero} - vs {f.rival}
                                </option>
                            ))}
                        </select>
                    </div>

                    <div className="date-section">
                        <div className="date-header">Fecha {fecha.numero} - vs {fecha.rival}</div>
                        
                        <div style={{marginBottom: '15px', padding: '12px', background: '#f0f9ff', borderRadius: '8px', border: '1px solid #0ea5e9'}}>
                            <strong>Partidos sin asignar: {partidosSinAsignar.length} de 26</strong>
                        </div>

                        <div style={{marginBottom: '15px'}}>
                            <label style={{display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer'}}>
                                <input 
                                    type="checkbox" 
                                    checked={categoriasHabilitadasCount > 0}
                                    onChange={abrirCategoriasModal}
                                />
                                <span>Habilitar jugadores de categor√≠as inferiores en superiores</span>
                            </label>
                            {categoriasHabilitadasCount > 0 && (
                                <div style={{marginTop: '8px', fontSize: '14px', color: '#10b981', fontWeight: '600'}}>
                                    ‚úì {categoriasHabilitadasCount} jugador(es) habilitado(s) en categor√≠as superiores
                                </div>
                            )}
                        </div>

                        <button 
                            className="btn btn-primary"
                            onClick={() => {
                                setEditandoHorario(null);
                                const horariosUsados = {};
                                fecha.partidos.forEach(p => {
                                    if (p.horario) {
                                        const key = `${p.dia}-${p.horario}`;
                                        horariosUsados[key] = true;
                                    }
                                });

                                const horariosPosibles = [
                                    { dia: 'sabado', hora: '09:00' },
                                    { dia: 'sabado', hora: '10:30' },
                                    { dia: 'sabado', hora: '12:00' },
                                    { dia: 'sabado', hora: '13:30' },
                                    { dia: 'sabado', hora: '15:00' },
                                    { dia: 'sabado', hora: '16:30' },
                                    { dia: 'sabado', hora: '17:45' },
                                    { dia: 'domingo', hora: '09:00' },
                                    { dia: 'domingo', hora: '10:30' },
                                    { dia: 'domingo', hora: '12:00' },
                                    { dia: 'domingo', hora: '13:30' },
                                    { dia: 'domingo', hora: '15:00' }
                                ];

                                const siguienteHorario = horariosPosibles.find(h => !horariosUsados[`${h.dia}-${h.hora}`]);

                                if (siguienteHorario) {
                                    setHorarioActual({ 
                                        dia: siguienteHorario.dia, 
                                        hora: siguienteHorario.hora, 
                                        partido1: '', 
                                        partido2: '' 
                                    });
                                } else {
                                    setHorarioActual({ dia: 'sabado', hora: '09:00', partido1: '', partido2: '' });
                                }
                                setShowHorarioModal(true);
                            }}
                        >
                            ‚ûï Agregar Horario
                        </button>

                        <div className="form-group" style={{marginTop: '20px'}}>
                            <label>Partido Bonus (vale 20 puntos)</label>
                            <select 
                                value={fecha.partidoBonus || ''}
                                onChange={(e) => {
                                    const nuevasFechas = [...fechas];
                                    nuevasFechas[fechaSeleccionada].partidoBonus = e.target.value ? parseInt(e.target.value) : null;
                                    setFechas(nuevasFechas);
                                }}
                            >
                                <option value="">Seleccionar partido bonus...</option>
                                {PARTIDOS.map(p => (
                                    <option key={p.id} value={p.id}>{p.tipo}</option>
                                ))}
                            </select>
                        </div>

                        <button 
                            className="btn btn-success"
                            onClick={() => generarPDF(fechaSeleccionada)}
                            style={{marginTop: '20px'}}
                        >
                            üìÑ Exportar PDF
                        </button>
                    </div>

                    {showCategoriasModal && (
                        <div className="modal" onClick={() => {}}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{maxWidth: '700px'}}>
                                <div className="modal-header">
                                    Habilitar Jugadores en Categor√≠as Superiores
                                </div>

                                <p style={{marginBottom: '20px', color: '#666'}}>
                                    Los jugadores habilitados NO contar√°n en el l√≠mite de 3 partidos cuando jueguen en categor√≠a superior.
                                </p>

                                {/* Caballeros 5ta en 4ta */}
                                <div style={{marginBottom: '20px', padding: '15px', background: '#f8f9fa', borderRadius: '8px'}}>
                                    <label style={{display: 'flex', alignItems: 'center', gap: '10px', fontWeight: '700', marginBottom: '10px'}}>
                                        <input 
                                            type="checkbox"
                                            checked={categoriasTemp.caballeros_5ta_en_4ta || false}
                                            onChange={(e) => setCategoriasTemp({...categoriasTemp, caballeros_5ta_en_4ta: e.target.checked})}
                                        />
                                        Caballeros 5ta ‚Üí 4ta
                                    </label>
                                    {categoriasTemp.caballeros_5ta_en_4ta && (
                                        <div style={{marginLeft: '30px'}}>
                                            {JUGADORES_GOAT.caballeros_5ta.map(j => (
                                                <label key={j.nombre} style={{display: 'block', marginBottom: '5px'}}>
                                                    <input 
                                                        type="checkbox"
                                                        checked={jugadoresHabilitadosTemp.some(jh => jh.jugador === j.nombre && jh.categoriaDestino === 'caballeros_4ta')}
                                                        onChange={() => toggleJugadorHabilitado(j.nombre, 'caballeros_4ta')}
                                                    />
                                                    {' '}{j.nombre}
                                                </label>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Caballeros 4ta en 3ra */}
                                <div style={{marginBottom: '20px', padding: '15px', background: '#f8f9fa', borderRadius: '8px'}}>
                                    <label style={{display: 'flex', alignItems: 'center', gap: '10px', fontWeight: '700', marginBottom: '10px'}}>
                                        <input 
                                            type="checkbox"
                                            checked={categoriasTemp.caballeros_4ta_en_3ra || false}
                                            onChange={(e) => setCategoriasTemp({...categoriasTemp, caballeros_4ta_en_3ra: e.target.checked})}
                                        />
                                        Caballeros 4ta ‚Üí 3ra
                                    </label>
                                    {categoriasTemp.caballeros_4ta_en_3ra && (
                                        <div style={{marginLeft: '30px'}}>
                                            {JUGADORES_GOAT.caballeros_4ta.map(j => (
                                                <label key={j.nombre} style={{display: 'block', marginBottom: '5px'}}>
                                                    <input 
                                                        type="checkbox"
                                                        checked={jugadoresHabilitadosTemp.some(jh => jh.jugador === j.nombre && jh.categoriaDestino === 'caballeros_3ra')}
                                                        onChange={() => toggleJugadorHabilitado(j.nombre, 'caballeros_3ra')}
                                                    />
                                                    {' '}{j.nombre}
                                                </label>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Caballeros 3ra en 2da */}
                                <div style={{marginBottom: '20px', padding: '15px', background: '#f8f9fa', borderRadius: '8px'}}>
                                    <label style={{display: 'flex', alignItems: 'center', gap: '10px', fontWeight: '700', marginBottom: '10px'}}>
                                        <input 
                                            type="checkbox"
                                            checked={categoriasTemp.caballeros_3ra_en_2da || false}
                                            onChange={(e) => setCategoriasTemp({...categoriasTemp, caballeros_3ra_en_2da: e.target.checked})}
                                        />
                                        Caballeros 3ra ‚Üí 2da
                                    </label>
                                    {categoriasTemp.caballeros_3ra_en_2da && (
                                        <div style={{marginLeft: '30px'}}>
                                            {JUGADORES_GOAT.caballeros_3ra.map(j => (
                                                <label key={j.nombre} style={{display: 'block', marginBottom: '5px'}}>
                                                    <input 
                                                        type="checkbox"
                                                        checked={jugadoresHabilitadosTemp.some(jh => jh.jugador === j.nombre && jh.categoriaDestino === 'caballeros_2da')}
                                                        onChange={() => toggleJugadorHabilitado(j.nombre, 'caballeros_2da')}
                                                    />
                                                    {' '}{j.nombre}
                                                </label>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Damas C en B */}
                                <div style={{marginBottom: '20px', padding: '15px', background: '#f8f9fa', borderRadius: '8px'}}>
                                    <label style={{display: 'flex', alignItems: 'center', gap: '10px', fontWeight: '700', marginBottom: '10px'}}>
                                        <input 
                                            type="checkbox"
                                            checked={categoriasTemp.damas_c_en_b || false}
                                            onChange={(e) => setCategoriasTemp({...categoriasTemp, damas_c_en_b: e.target.checked})}
                                        />
                                        Damas C ‚Üí B
                                    </label>
                                    {categoriasTemp.damas_c_en_b && (
                                        <div style={{marginLeft: '30px'}}>
                                            {JUGADORES_GOAT.damas_c.map(j => (
                                                <label key={j.nombre} style={{display: 'block', marginBottom: '5px'}}>
                                                    <input 
                                                        type="checkbox"
                                                        checked={jugadoresHabilitadosTemp.some(jh => jh.jugador === j.nombre && jh.categoriaDestino === 'damas_b')}
                                                        onChange={() => toggleJugadorHabilitado(j.nombre, 'damas_b')}
                                                    />
                                                    {' '}{j.nombre}
                                                </label>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Damas B en A */}
                                <div style={{marginBottom: '20px', padding: '15px', background: '#f8f9fa', borderRadius: '8px'}}>
                                    <label style={{display: 'flex', alignItems: 'center', gap: '10px', fontWeight: '700', marginBottom: '10px'}}>
                                        <input 
                                            type="checkbox"
                                            checked={categoriasTemp.damas_b_en_a || false}
                                            onChange={(e) => setCategoriasTemp({...categoriasTemp, damas_b_en_a: e.target.checked})}
                                        />
                                        Damas B ‚Üí A
                                    </label>
                                    {categoriasTemp.damas_b_en_a && (
                                        <div style={{marginLeft: '30px'}}>
                                            {JUGADORES_GOAT.damas_b.map(j => (
                                                <label key={j.nombre} style={{display: 'block', marginBottom: '5px'}}>
                                                    <input 
                                                        type="checkbox"
                                                        checked={jugadoresHabilitadosTemp.some(jh => jh.jugador === j.nombre && jh.categoriaDestino === 'damas_a')}
                                                        onChange={() => toggleJugadorHabilitado(j.nombre, 'damas_a')}
                                                    />
                                                    {' '}{j.nombre}
                                                </label>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                                    <button className="btn btn-primary" onClick={guardarCategorias}>
                                        Guardar
                                    </button>
                                    <button className="btn btn-danger" onClick={() => {
                                        setShowCategoriasModal(false);
                                    }}>
                                        Cancelar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showHorarioModal && (
                        <div className="modal" onClick={() => {
                            if (confirm('¬øCerrar sin guardar?')) {
                                setShowHorarioModal(false);
                                setHorarioActual({ dia: 'sabado', hora: '09:00', partido1: '', partido2: '' });
                                setEditandoHorario(null);
                            }
                        }}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    {editandoHorario ? 'Editar Horario' : `Agregar Horario (${partidosSinAsignar.length} partidos restantes)`}
                                </div>

                                <div className="form-group">
                                    <label>D√≠a</label>
                                    <select 
                                        value={horarioActual.dia}
                                        onChange={(e) => setHorarioActual({...horarioActual, dia: e.target.value})}
                                    >
                                        <option value="sabado">S√°bado</option>
                                        <option value="domingo">Domingo</option>
                                    </select>
                                </div>

                                <div className="form-group">
                                    <label>Horario</label>
                                    <select 
                                        value={horarioActual.hora}
                                        onChange={(e) => setHorarioActual({...horarioActual, hora: e.target.value})}
                                    >
                                        <option value="09:00">09:00</option>
                                        <option value="10:30">10:30</option>
                                        <option value="12:00">12:00</option>
                                        <option value="13:30">13:30</option>
                                        <option value="15:00">15:00</option>
                                        <option value="16:30">16:30</option>
                                        {horarioActual.dia === 'sabado' && <option value="17:45">17:45</option>}
                                    </select>
                                </div>

                                <div className="form-group">
                                    <label>Partido 1</label>
                                    <select 
                                        value={horarioActual.partido1}
                                        onChange={(e) => setHorarioActual({...horarioActual, partido1: e.target.value})}
                                    >
                                        <option value="">Seleccionar partido...</option>
                                        {partidosDisponiblesP1.map(p => (
                                            <option key={p.id} value={p.id}>{p.tipo}</option>
                                        ))}
                                    </select>
                                </div>

                                <div className="form-group">
                                    <label>Partido 2</label>
                                    <select 
                                        value={horarioActual.partido2}
                                        onChange={(e) => setHorarioActual({...horarioActual, partido2: e.target.value})}
                                        disabled={!horarioActual.partido1}
                                    >
                                        <option value="">Seleccionar partido...</option>
                                        {partidosDisponiblesP2.map(p => (
                                            <option key={p.id} value={p.id}>{p.tipo}</option>
                                        ))}
                                    </select>
                                </div>

                                <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                                    <button className="btn btn-primary" onClick={agregarHorario}>
                                        {editandoHorario ? 'Actualizar' : partidosSinAsignar.length > 2 ? 'Guardar y Continuar' : 'Guardar'}
                                    </button>
                                    <button className="btn btn-danger" onClick={() => {
                                        setShowHorarioModal(false);
                                        setHorarioActual({ dia: 'sabado', hora: '09:00', partido1: '', partido2: '' });
                                        setEditandoHorario(null);
                                    }}>
                                        Cancelar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div style={{marginTop: '30px'}}>
                        <h3 style={{marginBottom: '15px', color: '#1e3c72'}}>Horarios Configurados</h3>
                        
                        {Object.values(partidosPorHorario)
                            .sort((a, b) => {
                                if (a.dia !== b.dia) return a.dia === 'sabado' ? -1 : 1;
                                return a.hora.localeCompare(b.hora);
                            })
                            .map((horario, idx) => (
                            <div key={idx} style={{
                                background: '#f8f9fa',
                                padding: '15px',
                                borderRadius: '8px',
                                marginBottom: '15px',
                                border: '2px solid #ddd'
                            }}>
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px'}}>
                                    <strong style={{fontSize: '16px', color: '#1e3c72'}}>
                                        {horario.dia === 'sabado' ? 'S√°bado' : 'Domingo'} - {horario.hora}
                                    </strong>
                                    <div>
                                        <button 
                                            className="btn btn-primary"
                                            style={{padding: '6px 12px', fontSize: '14px', marginRight: '8px'}}
                                            onClick={() => editarHorario(horario.dia, horario.hora)}
                                        >
                                            ‚úèÔ∏è Editar
                                        </button>
                                        <button 
                                            className="btn btn-danger"
                                            style={{padding: '6px 12px', fontSize: '14px'}}
                                            onClick={() => eliminarHorario(horario.dia, horario.hora)}
                                        >
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </div>
                                {horario.partidos
                                    .sort((a, b) => (a.posicion || 0) - (b.posicion || 0))
                                    .map(partido => (
                                    <div key={partido.id} style={{
                                        background: 'white',
                                        padding: '10px',
                                        borderRadius: '6px',
                                        marginBottom: '8px',
                                        border: fecha.partidoBonus === partido.id ? '2px solid #f59e0b' : '1px solid #e5e7eb'
                                    }}>
                                        <strong>Partido {partido.posicion}: {partido.tipo}</strong>
                                        {fecha.partidoBonus === partido.id && <span style={{color: '#f59e0b', marginLeft: '10px'}}>‚≠ê BONUS</span>}
                                    </div>
                                ))}
                            </div>
                        ))}
                    </div>

                    <div className="match-grid" style={{marginTop: '30px'}}>
                        <h3 style={{marginBottom: '15px', color: '#1e3c72'}}>Asignaci√≥n de Jugadores</h3>
                        {fecha.partidos
                            .filter(p => p.horario)
                            .sort((a, b) => {
                                if (a.dia !== b.dia) return a.dia === 'sabado' ? -1 : 1;
                                if (a.horario !== b.horario) return a.horario.localeCompare(b.horario);
                                return (a.posicion || 0) - (b.posicion || 0);
                            })
                            .map(partido => (
                            <PartidoCard 
                                key={partido.id}
                                partido={partido}
                                fechaIndex={fechaSeleccionada}
                                fecha={fecha}
                                actualizarJugadores={actualizarJugadores}
                                contarPartidosJugador={contarPartidosJugador}
                                esBonus={fecha.partidoBonus === partido.id}
                            />
                        ))}
                    </div>
                </div>
            );
        }

        function PartidoCard({ partido, fechaIndex, fecha, actualizarJugadores, contarPartidosJugador, esBonus }) {
            const [jugadoresSeleccionados, setJugadoresSeleccionados] = useState(partido.jugadores || []);
            
            useEffect(() => {
                setJugadoresSeleccionados(partido.jugadores || []);
            }, [partido.jugadores]);

            // Obtener jugadores habilitados para este partido
            const jugadoresHabilitados = fecha.jugadoresHabilitados || [];
            
            const jugadoresDisponibles = partido.categorias.flatMap(cat => {
                const jugadoresBase = JUGADORES_GOAT[cat] || [];
                
                // Agregar jugadores habilitados de categor√≠as inferiores
                const jugadoresExtra = jugadoresHabilitados
                    .filter(jh => jh.categoriaDestino === cat)
                    .map(jh => {
                        // Encontrar el jugador original
                        const jugadorOriginal = Object.values(JUGADORES_GOAT)
                            .flat()
                            .find(j => j.nombre === jh.jugador);
                        
                        return {
                            ...jugadorOriginal,
                            esHabilitado: true,
                            categoriaOriginal: jugadorOriginal.categoria
                        };
                    });
                
                return [...jugadoresBase, ...jugadoresExtra];
            });

            const agregarJugador = (nombreJugador) => {
                if (jugadoresSeleccionados.length >= partido.numJugadores) {
                    alert(`Este partido solo permite ${partido.numJugadores} jugador(es)`);
                    return;
                }

                // Verificar si el jugador est√° habilitado en categor√≠a superior
                const jugadorInfo = jugadoresDisponibles.find(j => j.nombre === nombreJugador);
                const estaHabilitado = jugadorInfo && jugadorInfo.esHabilitado;
                
                // Solo contar partidos si NO est√° jugando en categor√≠a superior
                if (!estaHabilitado) {
                    const countPartidos = contarPartidosJugador(fechaIndex, nombreJugador);
                    if (countPartidos >= 3) {
                        alert(`${nombreJugador} ya est√° convocado para 3 partidos. No puede jugar m√°s.`);
                        return;
                    }
                }

                const nuevosJugadores = [...jugadoresSeleccionados, nombreJugador];
                setJugadoresSeleccionados(nuevosJugadores);
                actualizarJugadores(fechaIndex, partido.id, nuevosJugadores);
            };

            const eliminarJugador = (index) => {
                const nuevosJugadores = jugadoresSeleccionados.filter((_, i) => i !== index);
                setJugadoresSeleccionados(nuevosJugadores);
                actualizarJugadores(fechaIndex, partido.id, nuevosJugadores);
            };

            return (
                <div className={`match-card ${esBonus ? 'bonus' : ''}`}>
                    <div className="match-header">
                        <div>
                            <div className="match-type">
                                {partido.tipo}
                            </div>
                            {esBonus && <div style={{color: '#f59e0b', fontSize: '14px', fontWeight: '600'}}>‚≠ê PARTIDO BONUS (20 pts)</div>}
                        </div>
                        <div className="match-time">
                            {partido.dia === 'sabado' ? 'S√°b' : 'Dom'} {partido.horario} - P{partido.posicion}
                        </div>
                    </div>

                    <div style={{marginBottom: '10px'}}>
                        <strong>Jugadores asignados:</strong>
                        {jugadoresSeleccionados.length === 0 && <span style={{color: '#999'}}> Ninguno</span>}
                        <div style={{marginTop: '8px'}}>
                            {jugadoresSeleccionados.map((jugador, idx) => {
                                const jugadorObj = jugadoresDisponibles.find(j => j.nombre === jugador);
                                const esHabilitado = jugadorObj && jugadorObj.esHabilitado;
                                return (
                                    <div key={idx} style={{
                                        display: 'inline-block',
                                        background: esHabilitado ? '#10b981' : '#667eea',
                                        color: 'white',
                                        padding: '5px 12px',
                                        borderRadius: '6px',
                                        marginRight: '8px',
                                        marginBottom: '8px'
                                    }}>
                                        {jugador}
                                        {jugadorObj?.capitan && <span className="captain-badge">CAPIT√ÅN</span>}
                                        {esHabilitado && <span style={{
                                            background: 'rgba(255,255,255,0.3)',
                                            padding: '2px 6px',
                                            borderRadius: '4px',
                                            fontSize: '10px',
                                            marginLeft: '6px'
                                        }}>‚Üë</span>}
                                        <button 
                                            onClick={() => eliminarJugador(idx)}
                                            style={{
                                                marginLeft: '8px',
                                                background: 'rgba(255,255,255,0.3)',
                                                border: 'none',
                                                color: 'white',
                                                borderRadius: '4px',
                                                cursor: 'pointer',
                                                padding: '2px 6px'
                                            }}
                                        >
                                            ‚úï
                                        </button>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {jugadoresSeleccionados.length < partido.numJugadores && (
                        <div className="form-group" style={{marginBottom: '0'}}>
                            <label>Agregar jugador:</label>
                            <select 
                                onChange={(e) => {
                                    if (e.target.value) {
                                        agregarJugador(e.target.value);
                                        e.target.value = '';
                                    }
                                }}
                                defaultValue=""
                            >
                                <option value="">Seleccionar...</option>
                                {jugadoresDisponibles
                                    .filter(j => !jugadoresSeleccionados.includes(j.nombre))
                                    .map((j, idx) => {
                                        const count = contarPartidosJugador(fechaIndex, j.nombre);
                                        const esHabilitado = j.esHabilitado;
                                        return (
                                            <option key={idx} value={j.nombre}>
                                                {j.nombre} {j.capitan ? '(CAPIT√ÅN)' : ''} {esHabilitado ? '‚Üë ' : `- ${count}/3 partidos`}
                                            </option>
                                        );
                                    })}
                            </select>
                        </div>
                    )}

                    {jugadoresSeleccionados.some(j => {
                        const jugadorObj = jugadoresDisponibles.find(jd => jd.nombre === j);
                        const esHabilitado = jugadorObj && jugadorObj.esHabilitado;
                        if (esHabilitado) return false; // No mostrar advertencia para habilitados
                        
                        const count = contarPartidosJugador(fechaIndex, j);
                        return count > 3;
                    }) && (
                        <div className="player-count-warning">
                            ‚ö†Ô∏è Advertencia: Alg√∫n jugador supera el l√≠mite de 3 partidos
                        </div>
                    )}
                </div>
            );
        }

        function ResultadosTab({ fechas, resultados, toggleResultado }) {
            if (fechas.length === 0) {
                return (
                    <div className="warning">
                        No hay fechas configuradas todav√≠a.
                    </div>
                );
            }

            return (
                <div>
                    <h2 style={{marginBottom: '20px', color: '#1e3c72'}}>Resultados de Partidos</h2>
                    
                    {fechas.map((fecha, fechaIdx) => (
                        <div key={fechaIdx} className="date-section">
                            <div className="date-header">
                                Fecha {fecha.numero} - vs {fecha.rival}
                            </div>
                            
                            {fecha.partidos.map(partido => {
                                if (partido.jugadores.length === 0) return null;
                                
                                const key = `${fechaIdx}-${partido.id}`;
                                const ganado = resultados[key] || false;
                                const esBonus = fecha.partidoBonus === partido.id;
                                
                                return (
                                    <div key={partido.id} style={{
                                        background: ganado ? '#d1fae5' : '#fee2e2',
                                        padding: '15px',
                                        borderRadius: '8px',
                                        marginBottom: '10px',
                                        border: esBonus ? '2px solid #f59e0b' : '2px solid transparent'
                                    }}>
                                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                            <div>
                                                <strong>{partido.tipo}</strong>
                                                {esBonus && <span style={{color: '#f59e0b', marginLeft: '10px'}}>‚≠ê BONUS</span>}
                                                <div style={{fontSize: '14px', marginTop: '5px'}}>
                                                    {partido.jugadores.join(' / ')}
                                                </div>
                                            </div>
                                            <div className="checkbox-container">
                                                <input 
                                                    type="checkbox"
                                                    checked={ganado}
                                                    onChange={() => toggleResultado(fechaIdx, partido.id)}
                                                />
                                                <label style={{margin: 0}}>
                                                    {ganado ? 'GANADO ‚úì' : 'PERDIDO'}
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    ))}
                </div>
            );
        }

        function EstadisticasTab({ calcularEstadisticas }) {
            const stats = calcularEstadisticas();

            return (
                <div>
                    <h2 style={{marginBottom: '20px', color: '#1e3c72'}}>Estad√≠sticas del Equipo</h2>
                    
                    <div className="stats-section">
                        <h3>Estad√≠sticas Individuales</h3>
                        <table className="stats-table">
                            <thead>
                                <tr>
                                    <th>Jugador</th>
                                    <th>Singles G/P</th>
                                    <th>Dobles G/P</th>
                                    <th>Total G/P</th>
                                    <th>% Victorias</th>
                                </tr>
                            </thead>
                            <tbody>
                                {Object.entries(stats.jugadores)
                                    .sort((a, b) => {
                                        const totalA = a[1].total.ganados + a[1].total.perdidos;
                                        const totalB = b[1].total.ganados + b[1].total.perdidos;
                                        return totalB - totalA;
                                    })
                                    .map(([nombre, data]) => {
                                        const total = data.total.ganados + data.total.perdidos;
                                        const porcentaje = total > 0 ? ((data.total.ganados / total) * 100).toFixed(1) : 0;
                                        
                                        return (
                                            <tr key={nombre}>
                                                <td><strong>{nombre}</strong></td>
                                                <td>{data.singles.ganados} / {data.singles.perdidos}</td>
                                                <td>{data.dobles.ganados} / {data.dobles.perdidos}</td>
                                                <td>{data.total.ganados} / {data.total.perdidos}</td>
                                                <td>{porcentaje}%</td>
                                            </tr>
                                        );
                                    })}
                            </tbody>
                        </table>
                    </div>

                    <div className="stats-section">
                        <h3>Estad√≠sticas de Parejas</h3>
                        <table className="stats-table">
                            <thead>
                                <tr>
                                    <th>Pareja</th>
                                    <th>Ganados</th>
                                    <th>Perdidos</th>
                                    <th>% Victorias</th>
                                    <th>Partidos Jugados</th>
                                </tr>
                            </thead>
                            <tbody>
                                {Object.entries(stats.parejas)
                                    .sort((a, b) => (b[1].ganados + b[1].perdidos) - (a[1].ganados + a[1].perdidos))
                                    .map(([pareja, data]) => {
                                        const total = data.ganados + data.perdidos;
                                        const porcentaje = total > 0 ? ((data.ganados / total) * 100).toFixed(1) : 0;
                                        
                                        return (
                                            <tr key={pareja}>
                                                <td><strong>{pareja}</strong></td>
                                                <td>{data.ganados}</td>
                                                <td>{data.perdidos}</td>
                                                <td>{porcentaje}%</td>
                                                <td>
                                                    {data.fechas.map((f, idx) => (
                                                        <div key={idx} style={{fontSize: '12px', color: '#666'}}>
                                                            F{f.fecha} vs {f.rival}: {f.tipo} ({f.resultado ? '‚úì' : '‚úó'})
                                                        </div>
                                                    ))}
                                                </td>
                                            </tr>
                                        );
                                    })}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>